server {
  ## SSL ##
  listen 443;
  ssl on;
  ssl_certificate /etc/nginx/ssl/nginx.pem;
  ssl_certificate_key /etc/nginx/ssl/nginx.key;
  ssl_session_timeout 5m;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers HIGH+kEECDH+AESGCM:HIGH+kEECDH:HIGH+kEDH:HIGH:!aNULL;
  ssl_prefer_server_ciphers on;

  server_name {{domain}};
  root {{app_path}}/public;

  ## PASSENGER ##
  passenger_enabled on;
  passenger_ruby /usr/bin/ruby;
  passenger_nodejs /usr/bin/nodejs;
  passenger_sticky_sessions on;

  ## ENV ##
  {% if app_env is defined %}
    {% for item in app_env %}
      passenger_env_var {{ item }} {{ app_env[item] }};
    {% endfor %}
  {% endif %}
}
